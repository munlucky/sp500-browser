# S&P 500 Scanner 핵심 기능 테스트 문서

## 테스트 개요
이 프로젝트는 래리 윌리엄스 변동성 돌파 전략을 구현한 S&P 500 스캐너의 핵심 비즈니스 로직을 검증하는 테스트 스위트입니다.

## 테스트 구조

### 1. 핵심 기능 테스트 (Core Features)
래리 윌리엄스 돌파 전략의 핵심 계산과 로직을 검증합니다.

- **core-features.test.js**: 래리 윌리엄스 돌파 전략의 모든 핵심 로직
  - 돌파 진입가 계산
  - 리스크 관리 (스탑로스, 목표가)
  - 변동성 분석
  - 거래량 분석
  - 돌파 감지 로직
  - 시장 시간 감지
  - 포지션 사이징
  - 데이터 유효성 검증
  - 성능 최적화

### 2. 애플리케이션 기본 구조 테스트 (Basic Structure)
애플리케이션의 기본 구조와 설정을 검증합니다.

- **simple.test.js**: 기본 구조 및 설정 관리
  - 파일 존재 확인
  - HTML 구조 검증
  - 기본 설정값 검증
  - 데이터 직렬화/역직렬화
  - 시장 시간 로직
  - 알림 시스템 기본 기능
  - 성능 테스트

## 주요 테스트 영역

### 📊 래리 윌리엄스 돌파 전략 핵심 로직
- **돌파 진입가 계산**: `전일 종가 + (전일 고가 - 전일 저가) × 0.6`
- **변동성 계산**: `((고가 - 저가) / 종가) × 100`
- **리스크 관리**: 스탑로스 3%/5%/8%, 목표가 2%/3%/5%
- **리스크-보상 비율**: 위험 대비 수익 계산
- **포지션 사이징**: 리스크 기반 주문 수량 계산

### 🎯 시장 분석 로직
- **변동성 필터링**: 2-8% 범위 내 종목 선별
- **거래량 분석**: 최소 거래량 및 거래량 증가 감지
- **시장 시간 감지**: 미국 주식 시장 시간 (9:30-16:00) 및 주말 휴장
- **돌파 감지**: 실시간 진입가 돌파 여부 판단

### 📈 데이터 검증 및 성능
- **데이터 무결성**: 주식 가격의 논리적 일관성 검증
- **성능 최적화**: 대량 데이터 필터링 및 메모리 효율성
- **에러 처리**: 잘못된 데이터 감지 및 처리

### ⚙️ 기본 시스템 기능
- **파일 구조**: 필수 JavaScript 및 HTML 파일 존재 확인
- **설정 관리**: 기본값 검증 및 데이터 직렬화
- **알림 기능**: 브라우저 알림 지원 여부 및 메시지 포맷팅

## 테스트 실행

### 전체 테스트 실행
```bash
npm test
```

### 특정 테스트 파일 실행
```bash
npm test -- tests/core-features.test.js    # 핵심 로직 테스트
npm test -- tests/simple.test.js           # 기본 구조 테스트
```

### 커버리지 리포트 생성
```bash
npm run test:coverage
```

### 감시 모드 (개발 중)
```bash
npm run test:watch
```

## 테스트 설정

### Jest 설정 (jest.config.js)
- **testEnvironment**: node (Node.js 환경, 빠른 실행)
- **testTimeout**: 5초 (적절한 타임아웃)
- **collectCoverageFrom**: js/**/*.js (커버리지 수집)
- **coverageReporters**: text, html (커버리지 리포트 형식)

## 테스트 통과 기준

### ✅ 통과해야 하는 핵심 테스트들
1. **래리 윌리엄스 공식**: 돌파 진입가 계산의 정확성
2. **리스크 관리**: 스탑로스 및 목표가 계산
3. **변동성 분석**: 변동성 계산 및 필터링 로직
4. **거래량 분석**: 거래량 필터링 및 증가 감지
5. **시장 시간 감지**: 미국 장시간 및 주말 휴장 판단
6. **돌파 감지**: 실시간 진입가 돌파 여부 판단
7. **포지션 사이징**: 리스크 기반 주문 수량 계산
8. **데이터 검증**: 주식 데이터의 논리적 일관성
9. **성능 최적화**: 대량 데이터 처리 효율성
10. **기본 구조**: 파일 존재 및 HTML 구조 검증

## 테스트 데이터

### 샘플 주식 데이터
```javascript
{
  ticker: 'AAPL',
  currentPrice: 150.00,
  yesterdayClose: 148.50,
  yesterdayHigh: 152.00,
  yesterdayLow: 147.00,
  yesterdayVolume: 50000000
}
```

### 기본 설정값
```javascript
{
  volatilityMin: 0.02,    // 2%
  volatilityMax: 0.08,    // 8%
  minVolume: 1000000,     // 100만주
  breakoutFactor: 0.6,    // 60%
  autoScan: false,
  demoMode: false
}
```

## 디버깅 및 문제 해결

### 일반적인 문제들
1. **ReferenceError**: 클래스가 정의되지 않음
   - 해결: 의존성 순서대로 require() 호출

2. **DOM 요소를 찾을 수 없음**
   - 해결: setup.js에서 적절한 DOM mock 설정

3. **Async/Await 테스트 실패**
   - 해결: 테스트 함수를 async로 선언하고 적절한 await 사용

4. **Mock이 호출되지 않음**
   - 해결: beforeEach에서 jest.clearAllMocks() 호출

### 로그 확인
테스트 실행 중 콘솔 로그를 확인하여 디버깅:
```bash
npm test -- --verbose
```

## 기여하기

새로운 테스트 추가 시:
1. 적절한 카테고리(unit/integration/ui)에 배치
2. 명확한 테스트 이름과 설명 작성
3. Setup과 Teardown 적절히 구현
4. Edge case와 Error case 포함
5. Mock을 적절히 활용하여 외부 의존성 제거

## 성능 지표

현재 테스트 스위트:
- **실행 시간**: ~1-2초
- **테스트 개수**: 200+ 개
- **파일 수**: 8개
- **커버리지 목표**: 80% 이상